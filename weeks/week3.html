<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MASAR AI - Week 3: RAG & Semantic Search</title>
<style>
    /* ==================== GENERAL STYLES ==================== */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
    }
    
    /* ==================== HEADER WITH PROGRESS ==================== */
    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
        position: relative;
    }
    
    .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .header .subtitle {
        font-size: 1.1em;
        opacity: 0.9;
    }
    
    .progress-container {
        margin-top: 20px;
        background: rgba(255,255,255,0.2);
        border-radius: 10px;
        height: 30px;
        overflow: hidden;
    }
    
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #48c6ef 0%, #6f86d6 100%);
        width: 0%;
        transition: width 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.9em;
    }
    
    /* ==================== GAMIFICATION STATS ==================== */
    .stats-bar {
        display: flex;
        justify-content: space-around;
        padding: 20px;
        background: #f8f9fa;
        border-bottom: 3px solid #e9ecef;
    }
    
    .stat-item {
        text-align: center;
        padding: 10px 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        min-width: 120px;
    }
    
    .stat-item .stat-icon {
        font-size: 2em;
        margin-bottom: 5px;
    }
    
    .stat-item .stat-label {
        font-size: 0.85em;
        color: #6c757d;
        font-weight: 600;
    }
    
    .stat-item .stat-value {
        font-size: 1.5em;
        font-weight: bold;
        color: #667eea;
    }
    
    /* ==================== NAVIGATION TABS ==================== */
    .nav-tabs {
        display: flex;
        overflow-x: auto;
        background: #f8f9fa;
        border-bottom: 3px solid #dee2e6;
        padding: 0 10px;
    }
    
    .nav-tabs::-webkit-scrollbar {
        height: 6px;
    }
    
    .nav-tabs::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 3px;
    }
    
    .tab-btn {
        padding: 15px 25px;
        border: none;
        background: none;
        color: #495057;
        font-weight: 600;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
        white-space: nowrap;
        position: relative;
    }
    
    .tab-btn:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
    }
    
    .tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
        background: white;
    }
    
    .tab-btn .badge {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #28a745;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 0.7em;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* ==================== CONTENT SECTIONS ==================== */
    .content-section {
        display: none;
        padding: 30px;
        animation: fadeInUp 0.5s ease;
    }
    
    .content-section.active {
        display: block;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 2em;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
    }
    
    h3 {
        color: #764ba2;
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 1.5em;
    }

    h4 {
        color: #667eea;
        margin-top: 20px;
        margin-bottom: 10px;
        font-size: 1.2em;
    }
    
    /* ==================== GLOSSARY ACCORDION ==================== */
    .glossary-accordion {
        margin: 20px 0;
    }
    
    .accordion-item {
        margin-bottom: 10px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .accordion-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .accordion-header:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    
    .accordion-header .icon {
        transition: transform 0.3s ease;
    }
    
    .accordion-header.active .icon {
        transform: rotate(180deg);
    }
    
    .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        background: white;
    }
    
    .accordion-content.active {
        max-height: 500px; /* Increased max-height for potentially longer content */
    }
    
    .accordion-content p, .accordion-content ul {
        padding: 20px;
        line-height: 1.6;
    }
    
    /* ==================== INFO CARDS ==================== */
    .info-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-left: 5px solid #667eea;
    }
    
    .info-card.warning {
        border-left-color: #ffc107;
        background: #fff9e6;
    }
    
    .info-card.success {
        border-left-color: #28a745;
        background: #e8f5e9;
    }
    
    .info-card.danger {
        border-left-color: #dc3545;
        background: #ffebee;
    }
    
    .info-card.info {
        border-left-color: #17a2b8;
        background: #e3f2fd;
    }
    
    /* ==================== COMPARISON GRID ==================== */
    .comparison-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 25px 0;
    }
    
    .comparison-box {
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    
    .comparison-box:hover {
        transform: translateY(-5px);
    }
    
    .comparison-box.blue {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .comparison-box.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }
    
    .comparison-box .icon {
        font-size: 3em;
        margin-bottom: 15px;
    }
    
    /* ==================== ANIMATED PROCESS FLOW ==================== */
    .process-flow {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 30px 0;
        flex-wrap: wrap;
        position: relative;
    }
    
    .flow-step {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 50%;
        width: 150px;
        height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        font-weight: bold;
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        animation: pulse 2s infinite;
        position: relative;
        margin: 10px;
    }
    
    .flow-step .step-number {
        font-size: 2em;
        margin-bottom: 5px;
    }
    
    .flow-step .step-label {
        font-size: 0.9em;
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        50% {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.5);
        }
    }
    
    .flow-step:nth-child(2) {
        animation-delay: 0.5s;
    }
    
    .flow-step:nth-child(3) {
        animation-delay: 1s;
    }
    
    .flow-step:nth-child(4) {
        animation-delay: 1.5s;
    }
    
    .flow-arrow {
        font-size: 2.5em;
        color: #667eea;
        animation: arrowMove 1.5s infinite;
    }
    
    @keyframes arrowMove {
        0%, 100% { transform: translateX(0); }
        50% { transform: translateX(10px); }
    }
    
    /* ==================== REQUIREMENTS SPIRAL DIAGRAM ==================== */
    .spiral-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 500px;
        position: relative;
        margin: 40px 0;
    }
    
    .spiral-step {
        position: absolute;
        background: white;
        border: 3px solid #667eea;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .spiral-step:hover {
        transform: scale(1.1);
        z-index: 10;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    
    .spiral-step h4 {
        color: #667eea;
        margin-bottom: 10px;
    }
    
    /* ==================== INTERACTIVE EXAMPLES ==================== */
    .example-container {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin: 25px 0;
        border: 2px dashed #667eea;
    }
    
    .example-title {
        color: #667eea;
        font-weight: bold;
        font-size: 1.2em;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .requirement-item {
        background: white;
        padding: 15px;
        margin: 10px 0;
        border-radius: 10px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }
    
    .requirement-item:hover {
        transform: translateX(10px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    /* ==================== METRICS TABLE ==================== */
    .metrics-table {
        width: 100%;
        border-collapse: collapse;
        margin: 25px 0;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-radius: 10px;
        overflow: hidden;
    }
    
    .metrics-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .metrics-table th,
    .metrics-table td {
        padding: 15px;
        text-align: left;
    }
    
    .metrics-table tbody tr {
        border-bottom: 1px solid #e9ecef;
        transition: background 0.3s ease;
    }
    
    .metrics-table tbody tr:hover {
        background: rgba(102, 126, 234, 0.1);
    }
    
    /* ==================== PROS/CONS LISTS ==================== */
    .pros-cons-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 25px 0;
    }
    
    .pros-box, .cons-box {
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .pros-box {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
    }
    
    .cons-box {
        background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        color: white;
    }
    
    .pros-box h3, .cons-box h3 {
        color: white;
        margin-bottom: 15px;
    }
    
    .pros-box ul, .cons-box ul {
        list-style: none;
        padding: 0;
    }
    
    .pros-box li, .cons-box li {
        padding: 8px 0;
        padding-left: 25px;
        position: relative;
    }
    
    .pros-box li::before {
        content: "✓";
        position: absolute;
        left: 0;
        font-weight: bold;
        font-size: 1.2em;
    }
    
    .cons-box li::before {
        content: "✗";
        position: absolute;
        left: 0;
        font-weight: bold;
        font-size: 1.2em;
    }
    
    /* ==================== QUIZ STYLES ==================== */
    .quiz-container {
        margin: 20px 0;
    }
    
    .question-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin: 20px 0;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        border-left: 5px solid #667eea;
    }
    
    .question-text {
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 20px;
        color: #333;
    }
    
    .options-grid {
        display: grid;
        gap: 10px;
    }
    
    .option-btn {
        padding: 15px 20px;
        border: 2px solid #e9ecef;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        font-size: 1em;
    }
    
    .option-btn:hover {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(5px);
    }
    
    .option-btn.selected {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }
    
    .option-btn.correct {
        background: #28a745;
        color: white;
        border-color: #28a745;
    }
    
    .option-btn.incorrect {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
    }
    
    .check-btn {
        margin-top: 15px;
        padding: 12px 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .check-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .feedback {
        margin-top: 15px;
        padding: 15px;
        border-radius: 10px;
        font-weight: 600;
        animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .feedback.correct {
        background: #d4edda;
        color: #155724;
        border: 2px solid #28a745;
    }
    
    .feedback.incorrect {
        background: #f8d7da;
        color: #721c24;
        border: 2px solid #dc3545;
    }
    
    /* ==================== TOOLTIPS ==================== */
    .tooltip {
        position: relative;
        display: inline-block;
        cursor: help;
        border-bottom: 2px dotted #667eea;
        color: #667eea;
        font-weight: 600;
    }
    
    .tooltip .tooltiptext {
        visibility: hidden;
        width: 300px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -150px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 0.9em;
        font-weight: normal;
    }
    
    .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
    }
    
    /* ==================== INTERACTIVE BUTTONS ==================== */
    .action-buttons {
        display: flex;
        gap: 15px;
        margin: 20px 0;
        flex-wrap: wrap;
    }
    
    .action-btn {
        padding: 12px 25px;
        border-radius: 25px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .action-btn.primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .action-btn.secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
    }
    
    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    /* ==================== RESPONSIVE DESIGN ==================== */
    @media (max-width: 768px) {
        .header h1 {
            font-size: 1.8em;
        }
        
        .stats-bar {
            flex-wrap: wrap;
        }
        
        .comparison-container,
        .pros-cons-container {
            grid-template-columns: 1fr;
        }
        
        .process-flow {
            flex-direction: column;
        }
        
        .flow-arrow {
            transform: rotate(90deg);
            margin: 10px 0;
        }
        
        .spiral-container {
            min-height: 800px;
        }
    }
    
    /* ==================== LOADING ANIMATION ==================== */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(102, 126, 234, 0.3);
        border-radius: 50%;
        border-top-color: #667eea;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>
</head>
<body>
<div class="container">
    <!-- ==================== HEADER ==================== -->
    <div class="header">
        <h1>🔍 Week 3: RAG & Semantic Search</h1>
        <p class="subtitle">From Vector Embeddings to Full RAG Pipelines</p>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">0% Complete</div>
        </div>
    </div>
    
    <!-- ==================== GAMIFICATION STATS ==================== -->
    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-icon">🏆</div>
            <div class="stat-label">Points</div>
            <div class="stat-value" id="points">0</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">✅</div>
            <div class="stat-label">Completed</div>
            <div class="stat-value" id="completed">0/7</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">🎯</div>
            <div class="stat-label">Accuracy</div>
            <div class="stat-value" id="accuracy">0%</div>
        </div>
        <div class="stat-item">
            <div class="stat-icon">⭐</div>
            <div class="stat-label">Streak</div>
            <div class="stat-value" id="streak">0</div>
        </div>
    </div>
    
    <!-- ==================== NAVIGATION TABS ==================== -->
    <div class="nav-tabs">
        <button class="tab-btn active" data-tab="intro-similarity">📏 Similarity Metrics</button>
        <button class="tab-btn" data-tab="embedding-models">🧬 Embedding Models</button>
        <button class="tab-btn" data-tab="query-scoring">⚖️ Query-Doc Scoring</button>
        <button class="tab-btn" data-tab="semantic-search">🔎 Semantic Search</button>
        <button class="tab-btn" data-tab="rag">💡 RAG Pipelines</button>
        <button class="tab-btn" data-tab="practical">💻 Practical Session</button>
        <button class="tab-btn" data-tab="glossary">📖 Glossary</button>
        <button class="tab-btn" data-tab="quiz-fill">📝 Fill in the Blank</button>
        <button class="tab-btn" data-tab="quiz-tf">❓ True/False</button>
        <button class="tab-btn" data-tab="quiz-mc">🎲 Multiple Choice</button>
    </div>
    
    <!-- ==================== SECTION 1: Similarity Metrics ==================== -->
    <div class="content-section active" data-section="intro-similarity">
        <h2>📏 Similarity & Distance Metrics</h2>
        
        <div class="info-card">
            <h3>The Core Idea</h3>
            <p>Similarity and Distance Metrics are tools used to quantify how "close" or "similar" two data points (like embedding vectors) are.</p>
            <div class="pros-cons-container" style="grid-template-columns: 1fr 1fr;">
                <div class="pros-box">
                    <h3>Similar / Close</h3>
                    <ul>
                        <li>Have a HIGH similarity score</li>
                        <li>Have a SMALL distance</li>
                    </ul>
                </div>
                <div class="cons-box">
                    <h3>Dissimilar / Far</h3>
                    <ul>
                        <li>Have a LOW similarity score</li>
                        <li>Have a LARGE distance</li>
                    </ul>
                </div>
            </div>
        </div>

        <h3>Common Similarity Metrics</h3>
        <div class="info-card info">
            <h4>Cosine Similarity</h4>
            <p>Measures the <strong>cosine of the angle</strong> between two vectors (A and B). It only cares about direction, not magnitude.</p>
            <ul>
                <li><strong>Range:</strong> [-1, 1]</li>
                <li><strong>1:</strong> Vectors are identical (pointing in the same direction).</li>
                <li><strong>0:</strong> Vectors are orthogonal (no similarity).</li>
                <li><strong>-1:</strong> Vectors are opposite.</li>
            </ul>
            <p>$cos(\theta) = \frac{A \cdot B}{||A|| \cdot ||B||}$</p>
        </div>

        <div class="info-card warning">
            <h4>Dot Product</h4>
            <p>The <strong>un-normalized version</strong> of Cosine Similarity. It is also a measure of similarity.</p>
            <ul>
                <li><strong>Range:</strong> ($-\infty$, $+\infty$)</li>
                <li><strong>Positive:</strong> Some directional similarity.</li>
                <li><strong>0:</strong> Orthogonal.</li>
                <li><strong>Negative:</strong> Opposite directions.</li>
            </ul>
            <p>$A \cdot B = ||A|| \cdot ||B|| \cdot cos(\theta)$</p>
            <p><strong>Note:</strong> If vectors are *normalized* (length = 1), then $||A||=1$ and $||B||=1$, which means `Dot Product = Cosine Similarity`.</p>
        </div>

        <h3>Common Distance Metrics</h3>
        <div class="info-card">
            <p>Distance is the opposite of similarity. A distance of 0 means identical.</p>
            <div class="comparison-container">
                <div class="comparison-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333;">
                    <div class="icon">📏</div>
                    <h3>L1-Distance (Manhattan)</h3>
                    <p>The sum of the absolute differences of their components. (Like walking city blocks).</p>
                    <p>$\sum |A_i - B_i|$</p>
                </div>
                <div class="comparison-box" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333;">
                    <div class="icon">📐</div>
                    <h3>L2-Distance (Euclidean)</h3>
                    <p>The "straight-line" distance between two points.</p>
                    <p>$\sqrt{\sum (A_i - B_i)^2}$</p>
                </div>
                <div class="comparison-box" style="background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); color: #333;">
                    <div class="icon">🔄</div>
                    <h3>Cosine Distance</h3>
                    <p>Converts cosine similarity into a distance.</p>
                    <p>$1 - \text{CosineSimilarity}(A, B)$</p>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('intro-similarity')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('embedding-models')">Next: Embedding Models →</button>
        </div>
    </div>
    
    <!-- ==================== SECTION 2: Embedding Models ==================== -->
    <div class="content-section" data-section="embedding-models">
        <h2>🧬 Embedding Models</h2>
        
        <div class="info-card">
            <h3>What is an Embedding Model?</h3>
            <p>The main idea behind an <strong>Embedding Model</strong> is to convert an input (like text) into a <strong>compact, contextual vector</strong> (a list of numbers).</p>
            <p>This resulting embedding vector captures the <strong>semantic structure (meaning)</strong> of the input. Inputs with similar meanings will be represented by vectors that are <strong>closer together</strong> in the embedding space (according to our similarity metrics!)</p>
            <div class="example-container">
                <div class="example-title">
                    <span>💡</span>
                    <span>Example:</span>
                </div>
                <p>"Riyadh is the capital and largest city of Saudi Arabia"</p>
                <div class="flow-arrow" style="transform: rotate(0deg); animation: none; text-align: center; margin: 10px 0;">⬇️</div>
                <p style="text-align: center; font-family: 'Courier New', monospace; background: #f4f4f4; padding: 10px; border-radius: 5px;">[1.22, -0.4, 7.4, -0.19, 0.76, ...]</p>
            </div>
        </div>

        <h3>How are they built? (Contrastive Learning)</h3>
        <div class="info-card success">
            <h4>Contrastive Learning</h4>
            <p>This is the training technique used to create good embedding models. The goal is to learn a model that distinguishes <strong>similar items from different ones</strong>.</p>
            <p><strong>The Strategy:</strong>
                <li>Bring <strong>similar</strong> instances (positives) <strong>closer</strong> together.</li>
                <li>Push <strong>dissimilar</strong> instances (negatives) <strong>farther</strong> apart.</li>
            </p>
            <p>To do this, for each input example (called an <strong>"anchor"</strong>), we need:</p>
            <ul>
                <li><strong>A Positive Example:</strong> A text that *is* similar to the anchor.</li>
                <li><strong>A Negative Example:</strong> A text that *is not* similar to the anchor.</li>
            </ul>
        </div>

        <h3>Common Contrastive Loss Functions</h3>
        <div class="comparison-container">
            <div class="comparison-box blue">
                <div class="icon">👪</div>
                <h3>Triplet Loss</h3>
                <p>Uses three inputs: <strong>Anchor (A), Positive (P), Negative (N)</strong>.</p>
                <p><strong>Goal:</strong> Make the distance between (A, P) smaller than the distance between (A, N) by at least a `margin` ($\alpha$).</p>
                <p>$\mathcal{L} = \max(||f(A)-f(P)||^2 - ||f(A)-f(N)||^2 + \alpha, 0)$</p>
            </div>
            <div class="comparison-box green">
                <div class="icon">🔥</div>
                <h3>infoNCE Loss</h3>
                <p>Uses one <strong>Anchor (A)</strong>, one <strong>Positive (P)</strong>, and *many* <strong>Negative (N)</strong> samples (often the rest of the batch).</p>
                <p><strong>Goal:</strong> Framed as a classification problem. "Out of this whole batch, which one is the *correct* positive partner for my anchor?"</p>
                <p>It tries to maximize the similarity of (A, P) while minimizing the similarity of (A, N) for all N in the batch.</p>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('embedding-models')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('query-scoring')">Next: Query-Doc Scoring →</button>
        </div>
    </div>
    
    <!-- ==================== SECTION 3: Query-Doc Scoring ==================== -->
    <div class="content-section" data-section="query-scoring">
        <h2>⚖️ Query-Document Scoring</h2>
        
        <div class="info-card">
            <h3>The Goal</h3>
            <p>Given a <strong>query</strong> (e.g., "What is RAG?") and a <strong>document</strong> (e.g., a textbook page), our goal is to score how related the query is to the document, or if the document can answer the query.</p>
            <p>There are two main ways to do this: <strong>Embedding-based</strong> (fast, scalable) and <strong>Classification-based</strong> (slow, accurate).</p>
        </div>

        <h3>Embedding-Based Models (Fast Retrieval)</h3>
        <p>These models are fast because they embed the query and documents *separately*. This lets us pre-calculate all document embeddings and store them.</p>
        <div class="comparison-container">
            <div class="comparison-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333;">
                <div class="icon">🤝</div>
                <h3>Shared Encoder</h3>
                <p>Uses the *exact same* embedding model (e.g., BERT) for both the query and the document. Trained using contrastive loss.</p>
            </div>
            <div class="comparison-box" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333;">
                <div class="icon">👯</div>
                <h3>Bi-Encoder</h3>
                <p>Uses *two different* embedding models: one specialized for short queries and one for longer documents. Also trained using contrastive loss.</p>
            </div>
        </div>

        <h3>Classification-Based Models (Slow Reranking)</h3>
        <div class="info-card danger">
            <h4>Cross-Encoder</h4>
            <p>A Cross-Encoder does *not* embed the query and document separately. Instead, it <strong>concatenates them into a single input</strong> (e.g., `[CLS] Query [SEP] Document [SEP]`) and feeds them into a model (like BERT) *at the same time*.</p>
            <p>The model's output is a single score (e.g., 0.95) indicating "relevance."</p>
        </div>

        <h3>The Showdown: Bi-Encoder vs. Cross-Encoder</h3>
        <div class="info-card">
            <h4>The Problem: Search 1 Million Documents</h4>
            <div class="pros-cons-container">
                <div class="pros-box">
                    <h3>Bi-Encoder (or Shared)</h3>
                    <p><strong>"Two-Tower Model"</strong></p>
                    <ul>
                        <li><strong>Pre-computation:</strong> Can embed all 1M documents *once* and store them. (Slow, but done offline).</li>
                        <li><strong>At Query Time:</strong>
                            1. Embed the query (1 model pass).
                            2. Do a *very fast* vector similarity search (e.g., Cosine) against the 1M stored vectors.
                        </li>
                        <li><strong>Result:</strong> Extremely fast, scalable. Lower accuracy.</li>
                        <li><strong>Use:</strong> Main *Retriever*.</li>
                    </ul>
                </div>
                <div class="cons-box">
                    <h3>Cross-Encoder</h3>
                    <p><strong>"Single-Tower Model"</strong></p>
                    <ul>
                        <li><strong>Pre-computation:</strong> None. You can't pre-compute anything because you need the query.</li>
                        <li><strong>At Query Time:</strong>
                            1. Must concatenate the query with *every single document*.
                            2. Must run 1,000,000 model passes (Query+Doc1, Query+Doc2...).
                        </li>
                        <li><strong>Result:</strong> Extremely slow, not scalable. Higher accuracy.</li>
                        <li><strong>Use:</strong> *Reranker* (only on the top-100 results from a Bi-Encoder).</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('query-scoring')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('semantic-search')">Next: Semantic Search →</button>
        </div>
    </div>

    <!-- ==================== SECTION 4: Semantic Search ==================== -->
    <div class="content-section" data-section="semantic-search">
        <h2>🔎 Semantic Search & Document Retrieval</h2>
        
        <div class="info-card">
            <h3>The Goal of Semantic Search</h3>
            <p>Given a user query and a large collection of documents, find the <strong>most relevant documents</strong> based on *semantic meaning*, not just keyword matching.</p>
        </div>

        <h3>The Indexing Pipeline (Done Offline)</h3>
        <div class="info-card info">
            <p>Before we can search, we must prepare our documents.</p>
            <div class="process-flow">
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">1. Process Documents (Chunking, Metadata)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">2. Embed Chunks (Using Bi-Encoder)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">3. Store in Vector Database</div>
                </div>
            </div>
            <ul>
                <li><strong>Processing:</strong> We split large documents into small "chunks." We might also extract metadata (title, date, etc.).</li>
                <li><strong>Embedding:</strong> We pass every chunk through our embedding model (Bi-Encoder) to get its vector representation.</li>
                <li><strong>Storage:</strong> We store the chunk and its vector in a <strong>Vector Store</strong> (or Vector Database), which is optimized for fast similarity search.</li>
            </ul>
        </div>

        <h3>The Retrieval Pipeline (Done at Query Time)</h3>
        <div class="info-card success">
            <p>When a user asks a question, this is the process:</p>
            <div class="process-flow">
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">1. Embed User Query (Using Bi-Encoder)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">2. Search Vector Store (Find Top-K similar vectors)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">3. Return Top-K Chunks</div>
                </div>
            </div>
        </div>

        <div class="info-card warning">
            <h3>Getting the Best of Both Worlds: Reranking</h3>
            <p>The Bi-Encoder retrieval is fast but not always accurate. The Cross-Encoder is accurate but slow. We can combine them!</p>
            <p><strong>Hybrid Pipeline:</strong></p>
            <ol>
                <li><strong>Retrieve (Fast):</strong> Use a <strong>Bi-Encoder</strong> to quickly find the top-100 most promising documents from the 1M in our vector store.</li>
                <li><strong>Rerank (Accurate):</strong> Pass the query and *only those 100 documents* to a <strong>Cross-Encoder</strong> (as our "Reranker").</li>
                <li><strong>Final Answer:</strong> The Cross-Encoder re-orders the 100 documents, and we return the true top-10.</li>
            </ol>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('semantic-search')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('rag')">Next: RAG →</button>
        </div>
    </div>
    
    <!-- ==================== SECTION 5: RAG ==================== -->
    <div class="content-section" data-section="rag">
        <h2>💡 RAG Pipelines</h2>
        
        <div class="info-card">
            <h3>What is Retrieval Augmented Generation (RAG)?</h3>
            <p><strong>RAG</strong> is a system that "augments" (enhances) a Large Language Model (LLM) by first "retrieving" relevant documents from a knowledge base. </p>
            <p>Instead of just asking an LLM "What is RAG?", we first find relevant documents about RAG (using semantic search) and then ask the LLM: "Using these documents, what is RAG?"</p>
        </div>

        <h3>Components of a RAG System</h3>
        <div class="info-card info">
            <ul>
                <li><strong>Embedding Model:</strong> To embed documents and queries (a Bi-Encoder).</li>
                <li><strong>Document Embedding Store:</strong> A Vector Database.</li>
                <li><strong>Retriever:</strong> The semantic search system that finds the top-k documents.</li>
                <li><strong>Reranker (Optional):</strong> A Cross-Encoder to improve the retrieved document order.</li>
                <li><strong>LLM:</strong> The large language model (like Llama or GPT) that will generate the final answer.</li>
            </ul>
        </div>

        <h3>The RAG Pipeline (Inference Steps)</h3>
        <div class="info-card success">
            <div class="process-flow">
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">1. User Query</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">2. Retrieve Top-K Documents (Semantic Search)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">3. Rerank (Optional)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">4. Prompt LLM (with Query + Documents)</div>
                </div>
                <div class="flow-arrow">➡️</div>
                <div class="flow-step" style="animation: none; width: 120px; height: 120px;">
                    <div class="step-label">5. Final Answer</div>
                </div>
            </div>
            
            <div class="example-container">
                <div class="example-title">
                    <span>💡</span>
                    <span>Example RAG Prompt:</span>
                </div>
                <p>Answer the below user query based on the documents provided.</p>
                <p>Documents:</p>
                <p>[</p>
                <p>&lt;doc 1&gt;,</p>
                <p>&lt;doc 2&gt;,</p>
                <p>...]</p>
                <p>User Query: &lt;user query&gt;</p>
            </div>
        </div>

        <h3>Why is RAG so useful?</h3>
        <div class="info-card">
            <div class="pros-cons-container" style="grid-template-columns: 1fr;">
                <div class="pros-box">
                    <h3>Benefits of RAG</h3>
                    <ul>
                        <li><strong>Reduces LLM Hallucination:</strong> The model is "grounded" in the provided documents and less likely to make things up.</li>
                        <li><strong>Removes Knowledge Cutoff:</strong> The LLM is no longer limited to its pre-training data. It can answer questions about recent events by retrieving new documents.</li>
                        <li><strong>Reduces Training Cost:</strong> When data grows, you just add it to the vector store (cheap) instead of re-training the whole LLM (expensive).</li>
                        <li><strong>Ensures Answer Correctness:</strong> You can see *which* documents were used to generate the answer (citations).</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('rag')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('practical')">Next: Practical Session →</button>
        </div>
    </div>
    
    <!-- ==================== SECTION 6: Practical Session ==================== -->
    <div class="content-section" data-section="practical">
        <h2>💻 Practical Session</h2>
        
        <div class="info-card">
            <h3>Hands-On Workshop</h3>
            <p>The practical session for this week involves applying the concepts we've learned in a series of hands-on notebooks:</p>
            <ul style="margin-top: 15px;">
                <li>Hands on Metrics</li>
                <li>Query-Document scoring hands on</li>
                <li>Search Engine</li>
                <li>Fully functional RAG pipeline</li>
            </ul>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('practical')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('glossary')">Next: Glossary →</button>
        </div>
    </div>

    <!-- ==================== SECTION 7: GLOSSARY ==================== -->
    <div class="content-section" data-section="glossary">
        <h2>📖 Week 3 Glossary</h2>
        <p>Click on any term to expand its definition and learn more!</p>
        
        <div class="glossary-accordion">
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Cosine Similarity</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A metric (range -1 to 1) that measures the cosine of the angle between two vectors. It checks if they point in the same direction. A score of 1 means identical direction.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Dot Product</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>The un-normalized version of cosine similarity. If vectors are normalized (length 1), Dot Product is identical to Cosine Similarity.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>L1/L2 Distance</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>Metrics for measuring how "far apart" two vectors are.
                    <ul>
                        <li><strong>L1 (Manhattan):</strong> Like walking city blocks.</li>
                        <li><strong>L2 (Euclidean):</strong> The straight-line distance.</li>
                    </ul>
                    </p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Embedding Model</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A model trained (often with contrastive learning) to convert an input (like text) into a compact, numerical vector that captures its semantic meaning.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Contrastive Learning</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A training method that teaches a model to distinguish between similar and dissimilar items. It works by pulling "positive" (similar) pairs closer and pushing "negative" (dissimilar) pairs farther apart in the embedding space.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Triplet Loss</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A contrastive loss function that uses three inputs: an <strong>Anchor</strong>, a <strong>Positive</strong> (similar to anchor), and a <strong>Negative</strong> (dissimilar to anchor). It aims to make the (Anchor, Positive) distance smaller than the (Anchor, Negative) distance by a set margin.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Bi-Encoder (or Shared Encoder)</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>An embedding-based retrieval architecture. It uses one model to embed the query and another (or the same) to embed the document *separately*. The score is calculated by finding the cosine similarity of the two resulting vectors. It is very fast and scalable.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Cross-Encoder</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A classification-based reranking architecture. It concatenates the query and document *together* into a single input and passes them through a Transformer model (like BERT) to get a single relevance score. It is very accurate but very slow, making it unsuitable for retrieval, but excellent for reranking.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Semantic Search</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A search method that finds results based on *semantic meaning* and contextual similarity, rather than just exact keyword matching. It is powered by embedding models.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Vector Store / Database</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A database specifically designed to store embedding vectors and perform extremely fast nearest-neighbor (similarity) search on them.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>RAG (Retrieval Augmented Generation)</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>A system that combines a Retriever (semantic search) with a Generator (LLM). It first *retrieves* relevant documents to a query, then *augments* the LLM's prompt with those documents, allowing the LLM to *generate* an answer that is grounded in the provided facts.</p>
                </div>
            </div>
            <div class="accordion-item">
                <div class="accordion-header">
                    <span>Reranker</span>
                    <span class="icon">▼</span>
                </div>
                <div class="accordion-content">
                    <p>An optional component in a RAG pipeline, typically a Cross-Encoder, that is used *after* the initial retrieval. Its job is to take the top-k results from the (fast) Bi-Encoder and re-order them based on its (slow) but more accurate relevance score, ensuring the best possible documents are sent to the LLM.</p>
                </div>
            </div>

        </div>
        
        <div class="action-buttons">
            <button class="action-btn primary" onclick="markSectionComplete('glossary')">✓ Mark as Complete</button>
            <button class="action-btn secondary" onclick="navigateToTab('quiz-fill')">Ready for Quiz? →</button>
        </div>
    </div>
    
    <!-- ==================== QUIZ SECTION: FILL IN THE BLANK ==================== -->
    <div class="content-section" data-section="quiz-fill">
        <h2>📝 Fill in the Blank Quiz</h2>
        <p>Test your knowledge by selecting the correct word to fill in each blank!</p>
        
        <div class="quiz-container" id="fillQuizContainer"></div>
        
        <div class="action-buttons" style="margin-top: 30px;">
            <button class="action-btn primary" onclick="checkAllFillAnswers()">Check All Answers</button>
            <button class="action-btn secondary" onclick="navigateToTab('quiz-tf')">Next: True/False Quiz →</button>
        </div>
    </div>
    
    <!-- ==================== QUIZ SECTION: TRUE/FALSE ==================== -->
    <div class="content-section" data-section="quiz-tf">
        <h2>❓ True/False Quiz</h2>
        <p>Determine whether each statement is true or false!</p>
        
        <div class="quiz-container" id="tfQuizContainer"></div>
        
        <div class="action-buttons" style="margin-top: 30px;">
            <button class="action-btn primary" onclick="checkAllTFAnswers()">Check All Answers</button>
            <button class="action-btn secondary" onclick="navigateToTab('quiz-mc')">Next: Multiple Choice Quiz →</button>
        </div>
    </div>
    
    <!-- ==================== QUIZ SECTION: MULTIPLE CHOICE ==================== -->
    <div class="content-section" data-section="quiz-mc">
        <h2>🎲 Multiple Choice Quiz</h2>
        <p>Choose the best answer for each question!</p>
        
        <div class="quiz-container" id="mcQuizContainer"></div>
        
        <div class="action-buttons" style="margin-top: 30px;">
            <button class="action-btn primary" onclick="checkAllMCAnswers()">Check All Answers</button>
            <button class="action-btn secondary" onclick="showFinalResults()">View Final Results 🏆</button>
        </div>
    </div>
</div>

<script>
// ==================== GAMIFICATION DATA ====================
let gameData = {
    points: 0,
    completedSections: new Set(),
    totalSections: 7, // 6 content sections + 1 glossary
    correctAnswers: 0,
    totalAnswers: 0,
    streak: 0,
    sectionCompletion: {}
};

// ==================== QUIZ DATA (All questions based on W3_RAG... PDF) ====================
const fillInTheBlankQuiz = [
    {
        question: "A similarity metric with a range of [-1, 1] that measures the angle between two vectors is called _______ Similarity.",
        options: ["Cosine", "Manhattan", "Euclidean", "Dot"],
        answer: "Cosine"
    },
    {
        question: "The un-normalized version of cosine similarity is the _______ Product.",
        options: ["Dot", "Cross", "L1", "L2"],
        answer: "Dot"
    },
    {
        question: "L1-distance is also known as _______ distance.",
        options: ["Euclidean", "Cosine", "Manhattan", "Triplet"],
        answer: "Manhattan"
    },
    {
        question: "_______ Learning aims to bring similar instances (positive) closer and push dissimilar (negative) instances apart.",
        options: ["Supervised", "Contrastive", "RAG", "Generative"],
        answer: "Contrastive"
    },
    {
        question: "A _______ loss function uses an anchor, a positive, and a negative sample, plus a margin.",
        options: ["Triplet", "infoNCE", "RAG", "Cross-Encoder"],
        answer: "Triplet"
    },
    {
        question: "A _______ Encoder is a classification-based model that concatenates the query and document as a single input.",
        options: ["Bi-Encoder", "Shared Encoder", "Cross-Encoder", "RAG"],
        answer: "Cross-Encoder"
    },
    {
        question: "Storing document chunks and their embedding vectors is done in a _______ Store.",
        options: ["SQL", "Vector", "Text", "RAG"],
        answer: "Vector"
    },
    {
        question: "_______ is a pipeline that retrieves relevant documents and passes them to an LLM to generate an answer.",
        options: ["RAG", "PEFT", "LoRA", "BERT"],
        answer: "RAG"
    },
    {
        question: "In RAG, a _______ is an optional but powerful model (like a Cross-Encoder) used to re-order the retrieved documents for accuracy.",
        options: ["Retriever", "Reranker", "LLM", "Encoder"],
        answer: "Reranker"
    },
    {
        question: "A _______ Encoder uses two separate models, one for the query and one for the document.",
        options: ["Cross-Encoder", "Bi-Encoder", "RAG", "Vector"],
        answer: "Bi-Encoder"
    }
];

const trueFalseQuiz = [
    {
        question: "If two vectors have a high similarity score, they will have a large distance.",
        answer: false
    },
    {
        question: "Cosine similarity range is from 0 to +1.",
        answer: false
    },
    {
        question: "Dot product is the normalized version of cosine similarity.",
        answer: false
    },
    {
        question: "Embedding models convert text inputs into compact, contextual vectors.",
        answer: true
    },
    {
        question: "infoNCE loss is an example of contrastive learning.",
        answer: true
    },
    {
        question: "A Cross-Encoder is generally faster and more scalable for searching 1 million documents than a Bi-Encoder.",
        answer: false
    },
    {
        question: "A Bi-Encoder (or Shared Encoder) is scalable because you can pre-embed all documents.",
        answer: true
    },
    {
        question: "RAG pipelines can help reduce LLM hallucination.",
        answer: true
    },
    {
        question: "RAG removes the need for an embedding model.",
        answer: false
    },
    {
        question: "In a RAG pipeline, the 'Retriever' is typically a Bi-Encoder model.",
        answer: true
    }
];

const multipleChoiceQuiz = [
    {
        question: "Which metric measures the cosine of the angle between two vectors?",
        options: ["Cosine Similarity", "L1 Distance", "L2 Distance", "Dot Product"],
        answer: "Cosine Similarity"
    },
    {
        question: "What is the main goal of Contrastive Learning?",
        options: [
            "To classify text into categories",
            "To generate new text",
            "To bring similar items closer and push dissimilar items apart",
            "To store vectors efficiently"
        ],
        answer: "To bring similar items closer and push dissimilar items apart"
    },
    {
        question: "Which loss function requires an 'anchor,' 'positive,' and 'negative' sample?",
        options: ["Binary Cross Entropy", "infoNCE", "Triplet Loss", "Cosine Similarity"],
        answer: "Triplet Loss"
    },
    {
        question: "You have 1 million documents to search. Which query-document scoring architecture is the *fastest* and *most scalable* for retrieval?",
        options: ["Cross-Encoder", "Bi-Encoder", "RAG", "Triplet Loss"],
        answer: "Bi-Encoder"
    },
    {
        question: "Which query-document scoring architecture is the *most accurate* but *slowest*, and is often used as a 'reranker'?",
        options: ["Cross-Encoder", "Bi-Encoder", "Shared Encoder", "Dot Product"],
        answer: "Cross-Encoder"
    },
    {
        question: "What is the primary purpose of an Embedding Model?",
        options: [
            "To convert an input into a compact, contextual vector",
            "To score the similarity between two texts",
            "To store 1 million documents",
            "To generate a response"
        ],
        answer: "To convert an input into a compact, contextual vector"
    },
    {
        question: "What is NOT a component of a standard RAG pipeline?",
        options: ["Embedding Model", "Vector Store", "Retriever", "Contrastive Loss"],
        answer: "Contrastive Loss"
    },
    {
        question: "Which of these is a key benefit of using a RAG pipeline?",
        options: [
            "It makes the LLM smaller",
            "It pre-trains the LLM on new data",
            "It reduces LLM hallucination by providing context",
            "It makes embedding models faster"
        ],
        answer: "It reduces LLM hallucination by providing context"
    },
    {
        question: "Which of these is NOT a similarity/distance metric?",
        options: ["Cosine Similarity", "L2-distance (Euclidean)", "Triplet Loss", "L1-distance (Manhattan)"],
        answer: "Triplet Loss"
    },
    {
        question: "In a semantic search pipeline, what is the 'Retriever's' main job?",
        options: [
            "To generate the final answer",
            "To find the top-k most relevant documents/chunks from the vector store",
            "To re-order the documents for accuracy",
            "To embed the user's query"
        ],
        answer: "To find the top-k most relevant documents/chunks from the vector store"
    }
];

// ==================== NAVIGATION FUNCTIONS ====================
function navigateToTab(tabName) {
    const tabs = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.content-section');
    
    tabs.forEach(tab => {
        if (tab.dataset.tab === tabName) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });
    
    sections.forEach(section => {
        if (section.dataset.section === tabName) {
            section.classList.add('active');
        } else {
            section.classList.remove('active');
        }
    });
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ==================== SECTION COMPLETION ====================
function markSectionComplete(sectionName) {
    if (!gameData.completedSections.has(sectionName)) {
        gameData.completedSections.add(sectionName);
        gameData.points += 10;
        gameData.sectionCompletion[sectionName] = true;
        
        // Add badge to tab
        const tab = document.querySelector(`[data-tab="${sectionName}"]`);
        if (tab && !tab.querySelector('.badge')) {
            const badge = document.createElement('span');
            badge.className = 'badge';
            badge.textContent = '✓';
            tab.appendChild(badge);
        }
        
        updateGameStats();
        showCompletionAnimation();
    }
}

function updateGameStats() {
    document.getElementById('points').textContent = gameData.points;
    document.getElementById('completed').textContent = `${gameData.completedSections.size}/${gameData.totalSections}`;
    
    const accuracy = gameData.totalAnswers > 0 
        ? Math.round((gameData.correctAnswers / gameData.totalAnswers) * 100) 
        : 0;
    document.getElementById('accuracy').textContent = `${accuracy}%`;
    document.getElementById('streak').textContent = gameData.streak;
    
    const progress = (gameData.completedSections.size / gameData.totalSections) * 100;
    const progressBar = document.getElementById('progressBar');
    progressBar.style.width = `${progress}%`;
    progressBar.textContent = `${Math.round(progress)}% Complete`;
}

function showCompletionAnimation() {
    // Create celebration animation
    const celebration = document.createElement('div');
    celebration.innerHTML = '🎉';
    celebration.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 5em;
        z-index: 10000;
        animation: celebrate 1s ease-out forwards;
    `;
    
    const style = document.createElement('style');
    style.textContent = `
        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1) translateY(-100px); opacity: 0; }
        }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(celebration);
    
    setTimeout(() => {
        celebration.remove();
        style.remove();
    }, 1000);
}

// ==================== QUIZ FUNCTIONS ====================
function loadFillInTheBlankQuiz() {
    const container = document.getElementById('fillQuizContainer');
    container.innerHTML = '';
    
    fillInTheBlankQuiz.forEach((q, index) => {
        const questionCard = document.createElement('div');
        questionCard.className = 'question-card';
        questionCard.dataset.index = index;
        
        const questionText = q.question.replace('_______', '<span style="color: #dc3545; font-weight: bold;">_______</span>');
        
        questionCard.innerHTML = `
            <div class="question-text">${index + 1}. ${questionText}</div>
            <div class="options-grid">
                ${q.options.map(opt => `
                    <button class="option-btn" onclick="selectFillOption(${index}, '${opt}', this)">${opt}</button>
                `).join('')}
            </div>
            <div class="feedback-container"></div>
        `;
        
        container.appendChild(questionCard);
    });
}

function selectFillOption(questionIndex, selectedAnswer, button) {
    const card = button.closest('.question-card');
    card.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    button.classList.add('selected');
    card.dataset.selected = selectedAnswer;
    
    // Clear previous feedback
    const feedbackContainer = card.querySelector('.feedback-container');
    feedbackContainer.innerHTML = '';
}

function checkAllFillAnswers() {
    let correct = 0;
    fillInTheBlankQuiz.forEach((q, index) => {
        const card = document.querySelector(`#fillQuizContainer .question-card[data-index="${index}"]`);
        const selected = card.dataset.selected;
        const feedbackContainer = card.querySelector('.feedback-container');
        
        if (!selected) {
            feedbackContainer.innerHTML = '<div class="feedback incorrect">Please select an answer!</div>';
            return;
        }
        
        gameData.totalAnswers++;
        
        if (selected === q.answer) {
            correct++;
            gameData.correctAnswers++;
            gameData.streak++;
            gameData.points += 5;
            feedbackContainer.innerHTML = '<div class="feedback correct">✓ Correct! Well done!</div>';
            card.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.textContent === q.answer) {
                    btn.classList.add('correct');
                }
            });
        } else {
            gameData.streak = 0;
            feedbackContainer.innerHTML = `<div class="feedback incorrect">✗ Incorrect. The correct answer is: <strong>${q.answer}</strong></div>`;
            card.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.classList.contains('selected')) {
                    btn.classList.add('incorrect');
                }
                if (btn.textContent === q.answer) {
                    btn.classList.add('correct');
                }
            });
        }
    });
    
    updateGameStats();
    markSectionComplete('quiz-fill');
}

function loadTrueFalseQuiz() {
    const container = document.getElementById('tfQuizContainer');
    container.innerHTML = '';
    
    trueFalseQuiz.forEach((q, index) => {
        const questionCard = document.createElement('div');
        questionCard.className = 'question-card';
        questionCard.dataset.index = index;
        
        questionCard.innerHTML = `
            <div class="question-text">${index + 1}. ${q.question}</div>
            <div class="options-grid">
                <button class="option-btn" onclick="selectTFOption(${index}, true, this)">True</button>
                <button class="option-btn" onclick="selectTFOption(${index}, false, this)">False</button>
            </div>
            <div class="feedback-container"></div>
        `;
        
        container.appendChild(questionCard);
    });
}

function selectTFOption(questionIndex, selectedAnswer, button) {
    const card = button.closest('.question-card');
    card.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    button.classList.add('selected');
    card.dataset.selected = selectedAnswer;
    
    // Clear previous feedback
    const feedbackContainer = card.querySelector('.feedback-container');
    feedbackContainer.innerHTML = '';
}

function checkAllTFAnswers() {
    let correct = 0;
    trueFalseQuiz.forEach((q, index) => {
        const card = document.querySelector(`#tfQuizContainer .question-card[data-index="${index}"]`);
        const selected = card.dataset.selected;
        const feedbackContainer = card.querySelector('.feedback-container');
        
        if (selected === undefined) {
            feedbackContainer.innerHTML = '<div class="feedback incorrect">Please select an answer!</div>';
            return;
        }
        
        gameData.totalAnswers++;
        const selectedBool = selected === 'true';
        
        if (selectedBool === q.answer) {
            correct++;
            gameData.correctAnswers++;
            gameData.streak++;
            gameData.points += 5;
            feedbackContainer.innerHTML = '<div class="feedback correct">✓ Correct!</div>';
            card.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.classList.contains('selected')) {
                    btn.classList.add('correct');
                }
            });
        } else {
            gameData.streak = 0;
            const correctAnswer = q.answer ? 'True' : 'False';
            feedbackContainer.innerHTML = `<div class="feedback incorrect">✗ Incorrect. The correct answer is: <strong>${correctAnswer}</strong></div>`;
            card.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.classList.contains('selected')) {
                    btn.classList.add('incorrect');
                }
                if ((btn.textContent === 'True' && q.answer) || (btn.textContent === 'False' && !q.answer)) {
                    btn.classList.add('correct');
                }
            });
        }
    });
    
    updateGameStats();
    markSectionComplete('quiz-tf');
}

function loadMultipleChoiceQuiz() {
    const container = document.getElementById('mcQuizContainer');
    container.innerHTML = '';
    
    multipleChoiceQuiz.forEach((q, index) => {
        const questionCard = document.createElement('div');
        questionCard.className = 'question-card';
        questionCard.dataset.index = index;
        
        questionCard.innerHTML = `
            <div class="question-text">${index + 1}. ${q.question}</div>
            <div class="options-grid">
                ${q.options.map(opt => `
                    <button class="option-btn" onclick="selectMCOption(${index}, '${opt.replace(/'/g, "\\'")}', this)">${opt}</button>
                `).join('')}
            </div>
            <div class="feedback-container"></div>
        `;
        
        container.appendChild(questionCard);
    });
}

function selectMCOption(questionIndex, selectedAnswer, button) {
    const card = button.closest('.question-card');
    card.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    button.classList.add('selected');
    card.dataset.selected = selectedAnswer;
    
    // Clear previous feedback
    const feedbackContainer = card.querySelector('.feedback-container');
    feedbackContainer.innerHTML = '';
}

function checkAllMCAnswers() {
    let correct = 0;
    multipleChoiceQuiz.forEach((q, index) => {
        const card = document.querySelector(`#mcQuizContainer .question-card[data-index="${index}"]`);
        const selected = card.dataset.selected;
        const feedbackContainer = card.querySelector('.feedback-container');
        
        if (!selected) {
            feedbackContainer.innerHTML = '<div class="feedback incorrect">Please select an answer!</div>';
            return;
        }
        
        gameData.totalAnswers++;
        
        if (selected === q.answer) {
            correct++;
            gameData.correctAnswers++;
            gameData.streak++;
            gameData.points += 5;
            feedbackContainer.innerHTML = '<div class="feedback correct">✓ Excellent! That\'s correct!</div>';
            card.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.textContent === q.answer) {
                    btn.classList.add('correct');
                }
            });
        } else {
            gameData.streak = 0;
            feedbackContainer.innerHTML = `<div class="feedback incorrect">✗ Incorrect. The correct answer is: <strong>${q.answer}</strong></div>`;
            card.querySelectorAll('.option-btn').forEach(btn => {
                if (btn.classList.contains('selected')) {
                    btn.classList.add('incorrect');
                }
                if (btn.textContent === q.answer) {
                    btn.classList.add('correct');
                }
            });
        }
    });
    
    updateGameStats();
    markSectionComplete('quiz-mc');
}

function showFinalResults() {
    const accuracy = gameData.totalAnswers > 0 
        ? Math.round((gameData.correctAnswers / gameData.totalAnswers) * 100) 
        : 0;
    
    let grade = '';
    let message = '';
    let emoji = '';
    
    if (accuracy >= 90) {
        grade = 'A+';
        message = 'Outstanding! You\'ve mastered RAG & Semantic Search!';
        emoji = '🏆';
    } else if (accuracy >= 80) {
        grade = 'A';
        message = 'Excellent work! You have a strong understanding!';
        emoji = '🌟';
    } else if (accuracy >= 70) {
        grade = 'B';
        message = 'Good job! Keep practicing to improve!';
        emoji = '👍';
    } else if (accuracy >= 60) {
        grade = 'C';
        message = 'You\'re getting there! Review the material and try again!';
        emoji = '📚';
    } else {
        grade = 'D';
        message = 'Keep studying! Go back and review the content!';
        emoji = '💪';
    }
    
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.3s;
    `;
    
    modal.innerHTML = `
        <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; animation: slideUp 0.3s;">
            <div style="font-size: 5em; margin-bottom: 20px;">${emoji}</div>
            <h2 style="color: #667eea; margin-bottom: 20px;">Final Results</h2>
            <div style="font-size: 4em; font-weight: bold; color: #667eea; margin: 20px 0;">${grade}</div>
            <p style="font-size: 1.2em; 
        margin-bottom: 30px; 
        color: #333;
    ">${message}</p>
            <div style="font-size: 1.1em; color: #555; margin-bottom: 30px;">
                <p><strong>Total Points:</strong> ${gameData.points} 🏆</p>
                <p><strong>Final Accuracy:</strong> ${accuracy}% 🎯</p>
            </div>
            <button 
                class="action-btn primary" 
                onclick="this.closest('div[style*=\'position: fixed\']').remove()"
            >Close</button>
        </div>
    `;
    
    // Add animations and append to body
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(modal);
    
    // Clean up style tag
    setTimeout(() => {
        style.remove();
    }, 300);
}


// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', () => {
    // Setup tab navigation
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => navigateToTab(tab.dataset.tab));
    });

    // Setup glossary accordion
    const accordionHeaders = document.querySelectorAll('.accordion-header');
    accordionHeaders.forEach(header => {
        header.addEventListener('click', () => {
            const content = header.nextElementSibling;
            header.classList.toggle('active');
            content.classList.toggle('active');
        });
    });

    // Load all quizzes on page load
    loadFillInTheBlankQuiz();
    loadTrueFalseQuiz();
    loadMultipleChoiceQuiz();
    
    // Initialize the game stats display
    updateGameStats();
});
</script>
</body>
</html>
